<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProjectManager - Dashboard</title>
    <link rel="icon" href="./favicon.ico" type="image/x-icon">
    <style>
        body { font-family: Arial, sans-serif; margin: 0; display: flex; }
        h1 { color: #333; }
        #dashboard { border: 1px solid #ccc; padding: 15px; border-radius: 5px; width: 300px; margin: 20px; }
        .status { margin: 10px 0; }
        .active { color: green; }
        .inactive { color: red; }
        #three-container { flex-grow: 1; height: 100vh; }
        iframe { width: 100%; height: 100%; border: none; }
        button { padding: 5px 10px; margin-top: 10px; cursor: pointer; }
    </style>
</head>
<body>
    <div id="dashboard">
        <h1>Dashboard</h1>
        <div class="status" id="webgl-status">WebGL : Chargement...</div>
        <div class="status" id="webgpu-status">WebGPU : Chargement...</div>
        <div class="status" id="ssl-status">SSL : Chargement...</div>
        <div class="status" id="threejs-status">Three.js : Chargement...</div>
        <button id="toggleRenderer">Passer à WebGPU</button>
    </div>
    <div id="three-container">
        <iframe id="renderFrame" src="./src/Game/TestCube.html"></iframe>
    </div>
    <script type="module">
        // Import Three.js
        import * as THREE from '/src/ExternalLib/three.js/build/three.module.js';

        // Dashboard checks
        function checkWebGL() {
            const canvas = document.createElement('canvas');
            const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
            const status = gl ? 'Actif (WebGL 1.0)' : 'Inactif';
            document.getElementById('webgl-status').innerHTML = `WebGL : <span class="${gl ? 'active' : 'inactive'}">${status}</span>`;
            return !!gl;
        }

        async function checkWebGPU() {
            const isSupported = !!navigator.gpu;
            let versionInfo = 'N/A';
            if (isSupported) {
                try {
                    const adapter = await navigator.gpu.requestAdapter();
                    const features = adapter.features;
                    versionInfo = 'WebGPU (exp)';
                    if (features.size > 0) versionInfo += ` [${features.size} features]`;
                } catch (e) {
                    versionInfo = 'WebGPU (erreur d’initialisation)';
                }
            }
            const status = isSupported ? `Actif (${versionInfo})` : 'Inactif';
            document.getElementById('webgpu-status').innerHTML = `WebGPU : <span class="${isSupported ? 'active' : 'inactive'}">${status}</span>`;
            return isSupported;
        }

        function checkSSL() {
            const isSSL = window.location.protocol === 'https:';
            document.getElementById('ssl-status').innerHTML = `SSL : <span class="${isSSL ? 'active' : 'inactive'}">${isSSL ? 'Actif' : 'Inactif'}</span>`;
        }

        function checkThreeJS() {
            const isThreeLoaded = typeof THREE !== 'undefined' && THREE.WebGLRenderer;
            const version = isThreeLoaded ? THREE.REVISION : 'N/A';
            const status = isThreeLoaded ? `Actif (r${version})` : 'Inactif';
            document.getElementById('threejs-status').innerHTML = `Three.js : <span class="${isThreeLoaded ? 'active' : 'inactive'}">${status}</span>`;
        }

        // Toggle between WebGL and WebGPU renderers
        const toggleButton = document.getElementById('toggleRenderer');
        const renderFrame = document.getElementById('renderFrame');
        let isWebGPU = false;

        toggleButton.addEventListener('click', () => {
            isWebGPU = !isWebGPU;
            renderFrame.src = isWebGPU ? './src/Game/TestCubeWebGPU.html' : './src/Game/TestCube.html';
            toggleButton.textContent = isWebGPU ? 'Passer à WebGL' : 'Passer à WebGPU';
        });

        // Initialize dashboard
        window.onload = async () => {
            checkWebGL();
            await checkWebGPU();
            checkSSL();
            checkThreeJS();
            console.log("Dashboard chargé avec succès.");
        };
    </script>
</body>
</html>
